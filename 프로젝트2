import sys
import socket

#리다이렉트 최대 5번
MAX_REDIRECTS = 5


#리다이렉트 횟수 세기
class SimpleHttpClient:
    def __init__(self, url):
        self.original_url = url
        self.redirect_count = 0

#url 형식확인 및 http:// 제거
    def validate_url(self, url):
        if not url.startswith("http://"):
            sys.stderr.write("Error: URL must start with 'http://'\n")
            sys.exit(1)
        return url[len("http://"):]

#URL을 host, port, path로 파싱
    def parse_url(self, url):
        url = self.validate_url(url)
        parts = url.split("/", 1)
        host_port = parts[0]
        path = "/" + parts[1] if len(parts) > 1 else "/"

        if ':' in host_port:
            host, port_str = host_port.split(":", 1)
            if not port_str.isdigit():
                sys.stderr.write("Error: Invalid port number\n")
                sys.exit(1)
            port = int(port_str)
        else:
            host = host_port
            port = 80

        return host, port, path

#HTTP 요청 전송 및 응답 수신
    def send_http_request(self, host, port, path):
        try:
            with socket.socket(socket.AF_INET, socket.SOCK_STREAM) as client_socket:
                client_socket.connect((host, port))
                request = f"GET {path} HTTP/1.0\r\nHost: {host}\r\nConnection: close\r\n\r\n"
                client_socket.sendall(request.encode())

                response = b""
                while True:
                    data = client_socket.recv(1024)
                    if not data:
                        break
                    response += data

            return response
