import sys
import socket
from urllib.parse import urlparse

def follow_redirects(url, max_redirects=443):
    redirects = 0
    parsed_url = urlparse(url)
    
    if parsed_url.scheme == "https":
        print("Error: HTTPS URLs are not supported.")
        sys.exit(1)
    
    host = parsed_url.netloc
    path = parsed_url.path if parsed_url.path else "/"
    
    while redirects < max_redirects:
        try:
            with socket.create_connection((host, 80), timeout=5) as sock:
                request = f"GET {path} HTTP/1.1\r\nHost: {host}\r\nConnection: close\r\n\r\n"
                sock.sendall(request.encode())
                response = sock.recv(4096).decode(errors='ignore')
            
            headers = response.split("\r\n")
            status_line = headers[0]
            status = int(status_line.split()[1])
            location = next((h.split(": ")[1] for h in headers if h.lower().startswith("location:")), None)
            
            print(f"Status: {status}, Location: {location}")
            
            if status == 200:
                print("Success: Received 200 OK response.")
                sys.exit(0)
            
            if status >= 400:
                print(f"Error: Received HTTP {status} response.")
                sys.exit(1)
            
            if location:
                new_url = urlparse(location)
                if new_url.scheme == "https":
                    print("Error: Redirected to an HTTPS page, which is not supported.")
                    sys.exit(1)
                
                host = new_url.netloc if new_url.netloc else host
                path = new_url.path if new_url.path else "/"
                redirects += 1
            else:
                break
        except Exception as e:
            print(f"Error: {e}")
            sys.exit(1)
    
    print("Error: Maximum redirects exceeded.")
    sys.exit(1)

if __name__ == "__main__":
    if len(sys.argv) != 2:
        print("Usage: python script.py <URL>")
        sys.exit(1)
    
    follow_redirects(sys.argv[1])
